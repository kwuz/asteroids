<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 9</title>
	<script type="text/javascript" src="phaser-ce-2.8.6/build/phaser.min.js"></script>
	<script type="text/javascript" src="main.js"></script>
	<script type="text/javascript" src="ship.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
	//load art assets
    game.load.image('background', 'assets/background.png');
	game.load.image('ship','assets/OG_Ship.png');		// Ship and other art are far too large, draw by myself then
	game.load.image('Asteroid','assets/OG_Asteroid.png');
	game.load.image('bullet','assets/bullet.png');
	game.load.image('ufo','assets/OG_UFO.png');
	game.load.image('planet','assets/planet.png');
	game.load.spritesheet('Torpedo','assets/TorpedoSpriteSheet.png',256,256,90);
	
}
var ship;
var shipRadius = 100;
var shipAngle = 0;
var shipAnglerVelocity = 0;
var shipAnglerAcce = 0.001;

var UFOs;
var planets;
var Asteroids;
var bulletGroup;
var scoreText;
var HealthText;
var shipVelX;
var shipVelY;
var score = 0;
var planetHealth = 100;

var shipCollisionGroup;
var asternoidCollisionGroup;
var bulletCollisionGroup;
var ufoCollisionGroup;
var planetCollisionGroup;
var asternoidCollisionGroup_2;

var bulletInterval = 0;
var collisionGuard = [0, 0];
var freeOrPath = true;
var hug = false;
var firstHug = false;

var fireButton;
var switchButton;
var cursors;
function create() {
	//basic initiation
	game.add.image(0,0,'background');//add background
	game.physics.startSystem(Phaser.Physics.P2JS); //Detailed physic system
	game.physics.p2.setImpactEvents(true);// need this line to make score happen
	
	TorpedoSprite = game.add.tileSprite(game.world.width/2,game.world.height/2,256,256,'Torpedo');
	TorpedoSprite.scale.set(0.5);
	TorpedoSprite.animations.add('walk');
	TorpedoSprite.animations.play('walk', 50, true);
	//game.add.tween(TorpedoSprite).to({ x: game.width }, 10000, Phaser.Easing.Linear.None, true);
    game.physics.p2.restitution = 0.8;

	shipCollisionGroup = game.physics.p2.createCollisionGroup();
	asternoidCollisionGroup = game.physics.p2.createCollisionGroup();
	bulletCollisionGroup = game.physics.p2.createCollisionGroup();
	ufoCollisionGroup = game.physics.p2.createCollisionGroup();
	asternoidCollisionGroup_2 = game.physics.p2.createCollisionGroup();
	planetCollisionGroup = game.physics.p2.createCollisionGroup();
	//game.physics.p2.updateBoundsCollisionGroup();
	//create text
	scoreText = game.add.text(game.world.centerX+300, game.world.centerY-250, "Score is " + score, { 
		font: "30px Arial", 
		fill: "#ffffff", 
		align: "center" });
    scoreText.anchor.setTo(0.5, 0.5);
	
	HealthText = game.add.text(game.world.centerX+250, game.world.centerY-200, "Planet health is " + planetHealth, { 
		font: "30px Arial", 
		fill: "#ffffff", 
		align: "center" });
    HealthText.anchor.setTo(0.5, 0.5);
	
	// create ship
	ship = game.add.sprite(game.world.width/2-100,game.world.height/2-100,'ship');
	ship.scale.set(0.1);
	game.physics.p2.enable(ship,false);
	ship.body.setCollisionGroup(shipCollisionGroup);
	ship.body.mass = 10;
	shipVelX = 0.0;
	shipVelY = 0.0;
	//create asteroid
	Asteroids = game.add.group(); //commented for testing
	Asteroids.enableBody = true;
    Asteroids.physicsBodyType = Phaser.Physics.P2JS;
	var singleAsteroid = Asteroids.create(200,25,'Asteroid');
	singleAsteroid.body.velocity.x = 30;
	singleAsteroid.body.velocity.y = 30;
	
	singleAsteroid = Asteroids.create(600,25,'Asteroid');
	singleAsteroid.body.velocity.x = -30;
	singleAsteroid.body.velocity.y = 30;
	
	singleAsteroid = Asteroids.create(200,520,'Asteroid');
	singleAsteroid.body.velocity.x = 30;
	singleAsteroid.body.velocity.y = -30;
	
	singleAsteroid = Asteroids.create(500,550,'Asteroid');
	singleAsteroid.body.velocity.x = -30;
	singleAsteroid.body.velocity.y = -30;
	
	Asteroids.forEach(function(singleAsteroid){
		singleAsteroid.scale.setTo(0.2,0.2);
		singleAsteroid.body.setRectangle(40,40);
		singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup);
		singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup,ufoCollisionGroup,bulletCollisionGroup,planetCollisionGroup]);
		singleAsteroid.body.collides(planetCollisionGroup,hitNupdate, this);
		singleAsteroid.body.rotateLeft(game.rnd.integerInRange(100, 200));
		singleAsteroid.body.damping = 0.0;
	});
	
	//Create UFOs
	UFOs = game.add.group(); //commented for testing
	UFOs.enableBody = true;
    UFOs.physicsBodyType = Phaser.Physics.P2JS;
	
	var singleUFO = UFOs.create(200,25,'ufo');
	singleUFO.scale.setTo(0.1,0.1);
	singleUFO.visible = false;
	singleUFO.body.setRectangle(40,40);
	singleUFO.body.setCollisionGroup(ufoCollisionGroup);
	singleUFO.body.collides([shipCollisionGroup,asternoidCollisionGroup,ufoCollisionGroup,planetCollisionGroup,bulletCollisionGroup,]);
	singleUFO.body.rotateLeft(game.rnd.integerInRange(100, 200));
	singleUFO.body.damping = 0.0;
	singleUFO.body.velocity.x = 30;
	singleUFO.body.velocity.y = 30;
	
	//Create planet
	planets = game.add.group(); //commented for testing
	planets.enableBody = true;
    planets.physicsBodyType = Phaser.Physics.P2JS;
	
	var singlePLanet = planets.create(game.world.width/2,game.world.height/2,'planet');
	singlePLanet.scale.setTo(0.3,0.3);
	singlePLanet.body.setCircle(50);
	singlePLanet.body.setCollisionGroup(planetCollisionGroup);
	singlePLanet.body.collides([shipCollisionGroup,asternoidCollisionGroup,ufoCollisionGroup,planetCollisionGroup]);
	singlePLanet.body.collides(asternoidCollisionGroup,hitNupdate,this);
	singlePLanet.body.mass = 2000.0
	singlePLanet.body.damping = 1.0;
	//create bullet
	bulletGroup = game.add.group();//There are multiple bullets they should be created in update rather then here
	bulletGroup.enableBody = true;
	bulletGroup.physicsBodyType = Phaser.Physics.P2JS;
	
	bulletGroup.createMultiple(30, 'bullet');
    bulletGroup.setAll('anchor.x', 0.5);
    bulletGroup.setAll('anchor.y', 0.5);

    bulletGroup.forEach(function(singleBullet){
		singleBullet.scale.setTo(0.1,0.1);
		//singleBullet.body.setRectangle(40,40);
		singleBullet.body.setCollisionGroup(bulletCollisionGroup);
		singleBullet.body.collides(asternoidCollisionGroup, bulletHite, this);
		singleBullet.body.collides(ufoCollisionGroup,destory, this);
		//singleBullet.body.damping = 0.0;
	});

	// Create small Asteroids_2
	/*Asteroids_2 = game.add.group(); //commented for testing
	Asteroids_2.enableBody = true;
    Asteroids_2.physicsBodyType = Phaser.Physics.P2JS;*/
	/*
	for (var i = 1; i < 10; i++) {
		var singleAsteroid = Asteroids.create(game.world.randomX, game.world.randomY,'Asteroid');
		singleAsteroid.scale.setTo(0.1,0.1);
		singleAsteroid.body.setRectangle(40,40);
		singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup);
		singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup]);
	}
	Asteroids.forEach( function (singleAsteroid){
		singleAsteroid.body.rotateLeft(game.rnd.integerInRange(100, 200));
		singleAsteroid.body.thrust(game.rnd.integerInRange(5000, 9000));
	});*/
	/*create bullet
	Bullets = game.add.group();//There are multiple bullets they should be created in update rather then here
	var singleBullet = Bullets.create(100,5,'bullet');
	game.physics.p2.enable(singleBullet);
	*/
	//get game input
	game.time.events.add(Phaser.Timer.SECOND*2, function(){
		singleUFO.visible = true;
	}, this);
	ship.body.collides(asternoidCollisionGroup,destoryNupdate, this);
	ship.body.collides(ufoCollisionGroup,null, this);
	ship.body.collides(asternoidCollisionGroup_2,null,this);
	ship.body.collides(planetCollisionGroup,null,this);
	cursors = game.input.keyboard.createCursorKeys();
	fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
	switchButton = game.input.keyboard.addKey(Phaser.Keyboard.DOWN);
	switchButton.onDown.add(function(){
		freeOrPath = !freeOrPath;
		if(freeOrPath == false){firstHug = true;}
		hug = false;
		shipAngle = 0;
		shipAnglerVelocity = 0;
		shipAnglerAcce = 0.001;
	},this)
	game.input.keyboard.removeKeyCapture(Phaser.Keyboard.DOWN);
	resetAsternoid();
}	

function update() {	
	planets.forEach(moveToPlanet,this);
	//ship.body.setZeroVelocity();
	ship.body.angularVelocity = 0;
		
	//ship.body.x = ship.body.x + shipVelX;
	//ship.body.y = ship.body.y + shipVelY;
	ship.body.velocity.x = ship.body.velocity.x * 0.99;
	ship.body.velocity.y = ship.body.velocity.y * 0.99;
	
	Asteroids.forEach( function (singleAsteroid){
		//singleAsteroid.body.thrust(100);
		if(singleAsteroid.body.x > 800){
			singleAsteroid.body.x = 0;
		}else if(singleAsteroid.body.x < 0){
			singleAsteroid.body.x = 800;
		}
		if(singleAsteroid.body.y > 600){
			singleAsteroid.body.y = 0;
		}else if(singleAsteroid.body.y < 0){
			singleAsteroid.body.y = 600;
		}
	});
	
		UFOs.forEach( function (ufo){
		ufo.body.thrust(100);
		if(ufo.body.x > 800){
			ufo.body.x = 0;
		}else if(ufo.body.x < 0){
			ufo.body.x = 800;
		}
		if(ufo.body.y > 600){
			ufo.body.y = 0;
		}else if(ufo.body.y < 0){
			ufo.body.y = 600;
		}
	});
	
		/*Asteroids_2.forEach( function (singleAsteroid_2){
		//singleAsteroid_2.body.thrust(100);
		if(singleAsteroid_2.body.x > 800){
			singleAsteroid_2.body.x = 0;
		}else if(singleAsteroid_2.body.x < 0){
			singleAsteroid_2.body.x = 800;
		}
		if(singleAsteroid_2.body.y > 600){
			singleAsteroid_2.body.y = 0;
		}else if(singleAsteroid_2.body.y < 0){
			singleAsteroid_2.body.y = 600;
		}
	});*/
	
   
    if (cursors.left.isDown)
    {
		//updateScore(100);
		if(freeOrPath){
			ship.body.rotateLeft(100);
		}else{
		if(shipAnglerVelocity < 0.20){
			shipAnglerVelocity += shipAnglerAcce;
		}
		}
    }
    else if (cursors.right.isDown)
    {
		if(freeOrPath){
			ship.body.rotateRight(100);
		}else{
		if(shipAnglerVelocity > -0.20){
			shipAnglerVelocity -= shipAnglerAcce;
		}
		}
    }

    if (cursors.up.isDown)
    {
    	//ship.body.moveUp(400);
		if(freeOrPath){
			if(ship.body.velocity.x * ship.body.velocity.x + ship.body.velocity.y * ship.body.velocity.y < 60000){
				ship.body.velocity.x += 5*Math.cos(ship.body.rotation);
				ship.body.velocity.y += 5*Math.sin(ship.body.rotation);
			}
		}
    }
	/*if (cursors.down.isDown)
    {
		freeOrPath = !freeOrPath;
		if(freeOrPath == false){firstHug = true;}
		hug = false;
		shipAngle = 0;
		shipAnglerVelocity = 0;
		shipAnglerAcce = 0.001;
    }*/
	
	if(hug){
		if(firstHug){
			ship.body.rotation = 0; 
			firstHug = false;
			game.camera.shake(0.05, 500);
		}
			shipAngle += shipAnglerVelocity;
			ship.body.rotation += shipAnglerVelocity;
			ship.body.x = game.world.width/2 + shipRadius * Math.cos(shipAngle);
			ship.body.y = game.world.height/2 + shipRadius * Math.sin(shipAngle);
		if(shipAngle > 2 * Math.PI){
			shipAngle = shipAngle -  2 * Math.PI;
		}
	}
		
	if(ship.body.x > 800){
		ship.body.x = 0;
	}else if(ship.body.x < 0){
		ship.body.x = 800;
	}
	if(ship.body.y > 600){
		ship.body.y = 0;
	}else if(ship.body.y < 0){
		ship.body.y = 600;
	}
	if (fireButton.isDown){
		/*if (game.time.now > bulletInterval) {
			var length = ship.width * 0.5;
            var x = ship.body.x + (Math.cos(ship.body.rotation) * length);
            var y = ship.body.y + (Math.sin(ship.body.rotation) * length);
			var singleBullet = bulletGroup.create(x, y, 'bullet');
			singleBullet.body.rotation = ship.body.rotation;
			singleBullet.body.velocity.x = 400 * Math.cos(ship.body.rotation);
            singleBullet.body.velocity.y = 400 * Math.sin(ship.body.rotation);
            singleBullet.scale.setTo(0.1,0.1);
            singleBullet.body.setCollisionGroup(bulletCollisionGroup);
			singleBullet.body.collides(asternoidCollisionGroup, bulletHite, this);
			bulletInterval = game.time.now + 100;
		}*/
		
		if (game.time.now > bulletInterval) {
			var bullet = bulletGroup.getFirstExists(false);
    		if (bullet) {
                var length = ship.width * 0.5;
                var x = ship.body.x + (Math.cos(ship.body.rotation) * length);
                var y = ship.body.y + (Math.sin(ship.body.rotation) * length);
                
                bullet.reset(x, y);
                //bullet.lifespan = 1000;
                bullet.body.rotation = ship.body.rotation;
                bullet.body.velocity.x = 400 * Math.cos(ship.body.rotation);
                bullet.body.velocity.y = 400 * Math.sin(ship.body.rotation);
                bulletInterval = game.time.now + 100;
            }
		}
    	
    }
    
    bulletGroup.forEach(function (singleBullet){
		if(singleBullet.body.x >= 800 || singleBullet.body.x <= 0 || singleBullet.body.y >= 600 || singleBullet.body.y <= 0){
			singleBullet.kill();
		}
	});
}
function render(){
	game.debug.text('velocity' + shipVelX +'and'+ shipVelY , 32, 200);
	game.debug.spriteInfo(ship, 32, 32);
	}
	
function bulletHite(body1,body2){
	if(body1.sprite.body.id != collisionGuard[0] || body2.sprite.body.id != collisionGuard[1]){
		collisionGuard[0] = body1.sprite.body.id;
		collisionGuard[1] = body2.sprite.body.id;
		var size = body2.sprite.scale.x;
		var x = body2.sprite.body.x;
		var y = body2.sprite.body.y;
		
		body1.sprite.kill();
		body2.sprite.kill();
	//body2.sprite.body.removeCollisionGroup(asternoidCollisionGroup);
	//body1.sprite.body.removeCollisionGroup(bulletCollisionGroup);
	
	//bulletGroup.remove(body1.sprite);
	//Asteroids.remove(body2.sprite);
	
		if(size == 0.2){
			score = score + 50;
			scoreText.setText("Score is " + score);
			var singleAsteroid = Asteroids.create(x, y, 'Asteroid');
			singleAsteroid.scale.setTo(0.1, 0.1);
			singleAsteroid.body.setRectangle(40,40);
			singleAsteroid.body.velocity.x = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.velocity.y = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup);
			singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup,ufoCollisionGroup,asternoidCollisionGroup_2,bulletCollisionGroup,planetCollisionGroup]);
			singleAsteroid.body.collides(planetCollisionGroup,hitNupdate, this);
			singleAsteroid.body.rotateLeft(game.rnd.integerInRange(100, 200));
		
			singleAsteroid = Asteroids.create(x-20, y+20, 'Asteroid');
			singleAsteroid.scale.setTo(0.1, 0.1);
			singleAsteroid.body.setRectangle(40,40);
			singleAsteroid.body.velocity.x = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.velocity.y = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup);
			singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup,ufoCollisionGroup,asternoidCollisionGroup_2,bulletCollisionGroup,planetCollisionGroup]);
			singleAsteroid.body.collides(planetCollisionGroup,hitNupdate, this);
			singleAsteroid.body.rotateLeft(game.rnd.integerInRange(100, 200));
		}
	
		if(size == 0.1){
			score = score + 100;
			scoreText.setText("Score is " + score);
			var singleAsteroid = Asteroids.create(x, y, 'Asteroid');
			singleAsteroid.scale.setTo(0.05, 0.05);
			singleAsteroid.body.setRectangle(20,20);
			singleAsteroid.body.velocity.x = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.velocity.y = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup);
			singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup,ufoCollisionGroup,asternoidCollisionGroup_2,bulletCollisionGroup,planetCollisionGroup]);
			singleAsteroid.body.collides(planetCollisionGroup,hitNupdate, this);
			singleAsteroid.body.rotateLeft(game.rnd.integerInRange(100, 200));
		
			singleAsteroid = Asteroids.create(x-10, y+10, 'Asteroid');
			singleAsteroid.scale.setTo(0.05, 0.05);
			singleAsteroid.body.setRectangle(20,20);
			singleAsteroid.body.velocity.x = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.velocity.y = game.rnd.integerInRange(-30, 30);
			singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup);
			singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup,ufoCollisionGroup,asternoidCollisionGroup_2,bulletCollisionGroup,planetCollisionGroup]);
			singleAsteroid.body.collides(planetCollisionGroup,hitNupdate, this);
			singleAsteroid.body.rotateLeft(game.rnd.integerInRange(100, 200));
		}
		if(size == 0.05){
			score = score + 200;
			scoreText.setText("Score is " + score);
			}
	}

}
function destoryNupdate(body1,body2){	// call this function to add score 
	//score = score + 10;
	scoreText.setText("Score is " + score);
	
	/*var singleAsteroid = Asteroids.create(body2.sprite.x,body2.sprite.y,'Asteroid');
	singleAsteroid.body.rotation = body2.sprite.rotation;
	singleAsteroid.body.velocity = body2.sprite.velocity;
	singleAsteroid.scale.setTo(0.1,0.1);
	singleAsteroid.body.setRectangle(40,40);
	singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup);
	singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup]);
	singleAsteroid.body.damping = 0.0;
	singleAsteroid.body.thrust(500);*/
	//var singleAsteroid = Asteroids_2.create(body2.sprite.x,body2.sprite.y,'Asteroid');
	//singleAsteroid.body.rotation = body2.sprite.rotation;
	//singleAsteroid.body.velocity = body2.sprite.velocity;
	/*singleAsteroid.scale.setTo(0.1,0.1);
	singleAsteroid.body.setRectangle(40,40);
	singleAsteroid.body.setCollisionGroup(asternoidCollisionGroup_2);
	singleAsteroid.body.collides([shipCollisionGroup,asternoidCollisionGroup]);
	singleAsteroid.body.damping = 0.0;
	singleAsteroid.body.thrust(2000);
	body2.sprite.kill();*/
	}
function destory(body1,body2){
	//score = score + 100;
	body2.sprite.kill();
	}
	
function hitNupdate(body1,body2){
	planetHealth = planetHealth - 10;
	HealthText.setText("Planet health is " + planetHealth);
	//body2.sprite.kill();
}
function moveToPlanet (planet) { 
	if(freeOrPath){
		accelerateToObject(ship,planet,900);
	}else{	
		accelerateToPath(ship,planet,10000);  //start accelerateToObject on every bullet
	}
}
	
function accelerateToObject(obj1, obj2, speed) {
	var distance = ((obj1.body.x - obj2.body.x)*(obj1.body.x - obj2.body.x) + (obj1.body.y - obj2.body.y)*(obj1.body.y - obj2.body.y));
	//game.debug.text('velocity' + shipVelX +'and'+ shipVelY , 32, 200);
	game.debug.spriteInfo(ship, 32, 32);
	game.debug.text('distance' +((obj1.body.x - obj2.body.x)*(obj1.body.x - obj2.body.x) + (obj1.body.y - obj2.body.y)*(obj1.body.y - obj2.body.y)), 32 ,300);
	if(distance < 40000.0 ){
		if (typeof speed === 'undefined') { speed = 60; }
		game.debug.text('such in', 350, 200);
		var angle = Math.atan2(obj2.y - obj1.y, obj2.x - obj1.x);
		//obj1.body.rotation = angle + game.math.degToRad(90);  // correct angle of angry bullets (depends on the sprite used)
		obj1.body.force.x = Math.cos(angle) * speed;    // accelerateToObject 
		obj1.body.force.y = Math.sin(angle) * speed;
	}	
}

function accelerateToPath(obj1, obj2, speed) {
	var distance = ((obj1.body.x - obj2.body.x)*(obj1.body.x - obj2.body.x) + (obj1.body.y - obj2.body.y)*(obj1.body.y - obj2.body.y));
	game.debug.text('velocity' + shipVelX +'and'+ shipVelY , 32, 200);
	game.debug.spriteInfo(ship, 32, 32);
	game.debug.text('distance' +((obj1.body.x - obj2.body.x)*(obj1.body.x - obj2.body.x) + (obj1.body.y - obj2.body.y)*(obj1.body.y - obj2.body.y)), 32 ,300);
	if(distance < 200000.0 && distance > 12000.0){
		if (typeof speed === 'undefined') { speed = 60; }
		game.debug.text('such in', 350, 200);
		var angle = Math.atan2(obj2.y - obj1.y, obj2.x - obj1.x);
		obj1.body.rotation = angle + game.math.degToRad(180);  // correct angle of angry bullets (depends on the sprite used)
		obj1.body.force.x = Math.cos(angle) * speed;    // accelerateToObject 
		obj1.body.force.y = Math.sin(angle) * speed;
	}
	else if(distance < 8000.0){
		if (typeof speed === 'undefined') { speed = 60; }
		game.debug.text('pushout', 300, 200);
		var angle = -Math.atan2(obj2.y - obj1.y, obj2.x - obj1.x);
		obj1.body.rotation = -angle + game.math.degToRad(180);  // correct angle of angry bullets (depends on the sprite used)
		obj1.body.force.x = Math.cos(angle) * speed;    // accelerateToObject 
		obj1.body.force.y = Math.sin(angle) * speed;
	}
	else if(distance = 10000.0){
	// fetched with camera shaking
	hug = true;

	//ship.body.angle = Math.atan2(obj2.body.y - obj1.body.y,obj2.body.x - obj1.body.x);
	}
	
}

function resetAsternoid(){
	game.time.events.loop(Phaser.Timer.SECOND*3, function(){
		game.debug.text('Try respaw',200, 200);
		/*Asteroids.forEach(function(singleAsteroid){
			if(singleAsteroid.body.sprite.alive == false && singleAsteroid.body.sprite.x == 0.2 ){
			singleAsteroid.reset(game.randomX,game.randomY);}
		});*/
		var deadAsterois = Asteroids.getFirstExists(false);
		if(deadAsterois && deadAsterois.body.sprite.scale.x == 0.2){
			game.debug.text('respawed',250, 200);
			//deadAsterois.body.sprite.reset(game.randomX, game.randomY);
			deadAsterois.body.sprite.alive = true;
			deadAsterois.body.sprite.exists = true;
			deadAsterois.body.sprite.visible = true;
		}
	}, this);
}
</script>
</body>
</html>