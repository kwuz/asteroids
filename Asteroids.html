<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 9</title>
	<script type="text/javascript" src="phaser-ce-2.8.6/build/phaser.min.js"></script>
	<script type="text/javascript" src="main.js"></script>
	<script type="text/javascript" src="ship.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
	//load art assets
    game.load.image('background', 'assets/background.png');
	game.load.image('ship','assets/ship.png');		// Ship and other art are far too large, draw by myself then
	game.load.image('Asteroid','assets/Asteroid.png');
	game.load.image('bullet','assets/bullet.png');
	
	
}
var ship;
var Asteroids;
var Bullets;
var scoreText;
var shipVelX;
var shipVelY;

function create() {
	game.add.image(0,0,'background');//add background

	game.physics.startSystem(Phaser.Physics.P2JS); //Detailed physic system

	
	ship = game.add.sprite(game.world.width/2,game.world.height/2,'ship');
	ship.anchor.setTo(0.5, 0.5);
	game.physics.p2.enable(ship);
	shipVelX = 0.0;
	shipVelY = 0.0;
	
	/*
	Asteroids = game.add.group(); //commented for testing
	for (var i = 9; i < 10; i++) {
		var singleAsteroid = Asteroids.create(299+i*10,5,'Asteroid');
		game.physics.p2.enable(singleAsteroid);
	}
	*/
		
	Bullets = game.add.group();//There are multiple bullets they should be created in update rather then here
	var singleBullet = Bullets.create(100,5,'bullet');
	game.physics.p2.enable(singleBullet);
	
	scoreText = game.add.text(16, 16, 'test score', { fontSize: '32px', fill: '#900' });
	
	cursors = game.input.keyboard.createCursorKeys();
}	

function update() {
	game.debug.text('in game status', 32, 200);
	game.debug.spriteInfo(ship, 32, 32);
	ship.body.setZeroVelocity();
	ship.body.angularVelocity = 0;
	
	ship.body.x = ship.body.x + shipVelX;
	ship.body.y = ship.body.y + shipVelY;
   
    if (cursors.left.isDown)
    {
		ship.body.rotateLeft(20);
    }
    else if (cursors.right.isDown)
    {
		ship.body.rotateRight(20);
    }

    if (cursors.up.isDown)
    {
    	//ship.body.moveUp(400);
		if (shipVelX*shipVelX + shipVelY*shipVelY < 20*20) {
			shipVelX += 0.05*Math.cos(ship.body.rotation);
			shipVelY += 0.05*Math.sin(ship.body.rotation);
		}
    }
    else if (cursors.down.isDown)
    {
    	//ship.body.moveDown(400);
		if (shipVelX>=0 || shipVelY >=0) {
			shipVelX -= 0.05*Math.cos(ship.body.rotation);
			shipVelY -= 0.05*Math.sin(ship.body.rotation);
		}
    }
}


</script>
</body>
</html>